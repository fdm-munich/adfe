<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>Multiple Custom Audio Players</title>
        <style>
            body {
                background: black;
                margin: 0;
                padding: 0;
            }
            /* Wrapper for each player we dynamically generate */
            .audio-player-portrait {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                padding: 20px;
                border-radius: 15px;
                width: 90%;
                margin: 0 auto;
                box-sizing: border-box;
            }
            .audio-player-portrait .loading {
                text-align: center;
                font-size: 14px;
                color: #e1e1e6;
                margin-top: 10px;
            }
            .audio-player-portrait .player-controls {
                width: 100%;
            }
            .audio-player-portrait .hidden {
                display: none;
            }
            .controls {
                display: flex;
                justify-content: center;
                width: 100%;
                margin-bottom: 10px;
                align-items: center;
            }
            button {
                background: none;
                border: none;
                color: white;
                cursor: pointer;
                opacity: 0.5;
                pointer-events: none; /* Initially disable buttons */
                padding: 0;
                margin: 0 20px;
            }
            button.active {
                opacity: 1;
                pointer-events: auto; /* Enable buttons when active */
            }
            button:hover {
                opacity: 0.8;
            }
            input[type="range"] {
                width: 100%;
                height: 5px;
                border-radius: 5px;
                appearance: none;
                background: linear-gradient(to right, #3f3d56 0%, #3f3d56 100%);
            }
            input[type="range"]::-webkit-slider-thumb {
                appearance: none;
                width: 15px;
                height: 15px;
                border-radius: 50%;
                background: white;
                cursor: pointer;
            }
            input[type="range"]::-moz-range-thumb {
                width: 15px;
                height: 15px;
                border-radius: 50%;
                background: white;
                cursor: pointer;
            }
            .time-display {
                display: flex;
                justify-content: space-between;
                width: 100%;
                color: white;
                font-family: Newsreader, sans-serif;
                font-style: normal;
                font-weight: 400;
                font-size: 12px;
                margin-top: 5px;
            }
        </style>
    </head>
    <body>
        <!--
    Add as many <audio> tags as you want below.
    Each one will be wrapped in a custom player UI automatically.
  -->
        <audio src="https://quinceaudio.s3.ap-southeast-2.amazonaws.com/Love/Quince_LT006_Andrea_Dewar_24.mp3" preload="auto"></audio>
        <audio src="https://quinceaudio.s3.ap-southeast-2.amazonaws.com/Love/Quince_L001_Bruce_Dewar_2025.mp3" preload="auto"></audio>
        <!-- Add more <audio> elements if desired. -->

        <script>
            console.log("HELLO");
            // On DOMContentLoaded, find all <audio> tags and create players for each
            document.addEventListener("DOMContentLoaded", () => {
                const allAudios = document.querySelectorAll("audio");

                // We'll track each "player instance" in an array, so we can keep updating progress.
                console.log("HELLO in the listener", { allAudios });
                const playerInstances = [];

                allAudios.forEach((audioElement) => {
                    audioElement.load();
                    // Create the wrapper that holds everything for this audio
                    const wrapper = document.createElement("div");
                    wrapper.classList.add("audio-player-portrait");

                    // Insert the wrapper in the DOM just before the <audio> element
                    audioElement.parentNode.insertBefore(wrapper, audioElement);

                    // Move the <audio> inside the wrapper
                    wrapper.appendChild(audioElement);

                    // Create the "Loading..." indicator
                    const loadingMessage = document.createElement("div");
                    loadingMessage.classList.add("loading");
                    loadingMessage.textContent = "Loading audio...";
                    wrapper.appendChild(loadingMessage);

                    // Create a container for the player controls (initially hidden)
                    const controlsContainer = document.createElement("div");
                    controlsContainer.classList.add("player-controls", "hidden");
                    wrapper.appendChild(controlsContainer);

                    // -- Controls row
                    const controlsRow = document.createElement("div");
                    controlsRow.classList.add("controls");
                    controlsContainer.appendChild(controlsRow);

                    // Rewind button
                    const rewindButton = createIconButton(`
          <svg width="30" height="30" viewBox="0 0 24 24" fill="none">
            <path
              d="M4.30839 7.34849C4.55839 7.01849 5.02839 6.94849 5.35839 7.19849C5.68839 7.44849 5.75839 7.91849 5.50839 8.24849C4.42839 9.68849 3.85839 11.3685 3.85839 13.1085C3.85839 17.5985 7.50839 21.2485 12.0056 21.2485C16.4956 21.2485 20.1456 17.5985 20.1456 13.1085C20.1456 8.61849 16.4956 4.97849 12.0056 4.97849C11.4256 4.97849 10.8356 5.04849 10.1956 5.19849C10.1656 5.20849 10.1356 5.19849 10.0956 5.19849C10.0756 5.19849 10.0456 5.21849 10.0256 5.21849C9.99556 5.21849 9.97556 5.20849 9.94556 5.20849C9.90556 5.20849 9.87556 5.19849 9.84556 5.18849C9.79556 5.17849 9.74556 5.15849 9.69556 5.12849C9.66556 5.10849 9.62556 5.09849 9.59556 5.07849C9.58556 5.06849 9.56556 5.06849 9.55556 5.05849C9.52556 5.03849 9.51556 5.00849 9.49556 4.98849C9.45556 4.94849 9.42556 4.91849 9.39556 4.86849C9.36556 4.82849 9.35556 4.77849 9.33556 4.73849C9.32556 4.70849 9.30556 4.67849 9.29556 4.64849C9.29556 4.62849 9.29556 4.61849 9.29556 4.59849C9.28556 4.54849 9.28556 4.49849 9.29556 4.44849C9.29556 4.39849 9.29556 4.35849 9.30556 4.30849C9.31556 4.26849 9.33556 4.22849 9.35556 4.17849C9.37556 4.12849 9.39556 4.07849 9.42556 4.03849C9.43556 4.01849 9.43556 4.00849 9.44556 3.99849L11.4216 1.52849C11.6816 1.20849 12.1516 1.15849 12.4716 1.40849C12.7916 1.66849 12.8416 2.13849 12.5916 2.45849L11.7716 3.47849C11.8516 3.47849 11.9316 3.46849 12.0116 3.46849C17.3216 3.46849 21.6516 7.78849 21.6516 13.1085C21.6516 18.4285 17.3316 22.7485 12.0116 22.7485C6.69156 22.7485 2.37156 18.4285 2.37156 13.1085C2.36156 11.0385 3.04156 9.04849 4.30839 7.34849Z"
              fill="white"/>
            <path
              d="M9.5415 16.6708C9.1315 16.6708 8.7915 16.3308 8.7915 15.9208V12.5308L8.6015 12.7508C8.3215 13.0608 7.8515 13.0808 7.5415 12.8108C7.2315 12.5308 7.2115 12.0608 7.4815 11.7508L8.9815 10.0808C9.1915 9.85081 9.5215 9.77081 9.8115 9.88081C10.1015 9.99081 10.2915 10.2708 10.2915 10.5808V15.9308C10.2915 16.3408 9.9615 16.6708 9.5415 16.6708Z"
              fill="white"/>
            <path
              d="M14 16.6703C12.48 16.6703 11.25 15.4403 11.25 13.9203V12.5703C11.25 11.0503 12.48 9.82031 14 9.82031C15.52 9.82031 16.75 11.0503 16.75 12.5703V13.9203C16.75 15.4403 15.52 16.6703 14 16.6703ZM14 11.3303C13.31 11.3303 12.75 11.8903 12.75 12.5803V13.9303C12.75 14.6203 13.31 15.1803 14 15.1803C14.69 15.1803 15.25 14.6203 15.25 13.9303V12.5803C15.25 11.8903 14.69 11.3303 14 11.3303Z"
              fill="white"/>
          </svg>
        `);
                    controlsRow.appendChild(rewindButton);

                    // Play button
                    const playButton = createIconButton(`
          <svg width="50" height="50" viewBox="0 0 30 30" fill="none">
            <path
              d="M8.32137 25.586C7.9759 25.5853 7.63655 25.4948 7.33669 25.3232C6.66148 24.9406 6.24173 24.1978 6.24173 23.3915V7.07398C6.24173 6.26542 6.66148 5.52494 7.33669 5.14232C7.64369 4.96589 7.99244 4.87516 8.3465 4.87961C8.70056 4.88407 9.04692 4.98354 9.34938 5.16764L23.2952 13.5155C23.5859 13.6977 23.8255 13.9508 23.9916 14.251C24.1577 14.5511 24.2448 14.8886 24.2448 15.2316C24.2448 15.5747 24.1577 15.9121 23.9916 16.2123C23.8255 16.5125 23.5859 16.7655 23.2952 16.9478L9.34713 25.2979C9.0376 25.485 8.68307 25.5846 8.32137 25.586V25.586Z"
              fill="white"/>
          </svg>
        `);
                    controlsRow.appendChild(playButton);

                    // Pause button (hidden by default)
                    const pauseButton = createIconButton(`
          <svg width="50" height="50" viewBox="0 0 30 30" fill="none">
            <rect x="7" y="5" width="5" height="20" fill="white" />
            <rect x="18" y="5" width="5" height="20" fill="white" />
          </svg>
        `);
                    pauseButton.classList.add("hidden");
                    controlsRow.appendChild(pauseButton);

                    // Forward button
                    const forwardButton = createIconButton(`
          <svg width="30" height="30" viewBox="0 0 24 24" fill="none">
            <path
              d="M19.6916 7.34849C19.4416 7.01849 18.9716 6.94849 18.6416 7.19849C18.3116 7.44849 18.2416 7.91849 18.4916 8.24849C19.5716 9.68849 20.1416 11.3685 20.1416 13.1085C20.1416 17.5985 16.4916 21.2485 12.0016 21.2485C7.51156 21.2485 3.86156 17.5985 3.86156 13.1085C3.86156 8.61849 7.51156 4.97849 12.0016 4.97849C12.5816 4.97849 13.1716 5.04849 13.8116 5.19849C13.8416 5.20849 13.8716 5.19849 13.9116 5.19849C13.9316 5.19849 13.9616 5.21849 13.9816 5.21849C14.0116 5.21849 14.0316 5.20849 14.0616 5.20849C14.1016 5.20849 14.1316 5.19849 14.1616 5.18849C14.2116 5.17849 14.2616 5.15849 14.3116 5.12849C14.3416 5.10849 14.3816 5.09849 14.4116 5.07849C14.4216 5.06849 14.4416 5.06849 14.4516 5.05849C14.4816 5.03849 14.4916 5.00849 14.5116 4.98849C14.5516 4.94849 14.5816 4.91849 14.6116 4.86849C14.6416 4.82849 14.6516 4.77849 14.6716 4.73849C14.6816 4.70849 14.7016 4.67849 14.7116 4.64849C14.7116 4.62849 14.7116 4.61849 14.7116 4.59849C14.7216 4.54849 14.7216 4.49849 14.7116 4.44849C14.7116 4.39849 14.7116 4.35849 14.7016 4.30849C14.6916 4.26849 14.6716 4.22849 14.6516 4.17849C14.6316 4.12849 14.6116 4.07849 14.5816 4.03849C14.5716 4.01849 14.5716 4.00849 14.5616 3.99849L12.5816 1.52849C12.3216 1.20849 11.8516 1.15849 11.5316 1.40849C11.2116 1.66849 11.1616 2.13849 11.4116 2.45849L12.2316 3.47849C12.1516 3.47849 12.0716 3.46849 11.9916 3.46849C6.68156 3.46849 2.35156 7.78849 2.35156 13.1085C2.35156 18.4285 6.67156 22.7485 11.9916 22.7485C17.3116 22.7485 21.6316 18.4285 21.6316 13.1085C21.6416 11.0385 20.9616 9.04849 19.6916 7.34849Z"
              fill="white"/>
            <path
              d="M9.5415 16.6708C9.1315 16.6708 8.7915 16.3308 8.7915 15.9208V12.5308L8.6015 12.7508C8.3215 13.0608 7.8515 13.0808 7.5415 12.8108C7.2315 12.5308 7.2115 12.0608 7.4815 11.7508L8.9815 10.0808C9.1915 9.85081 9.5215 9.77081 9.8115 9.88081C10.1015 9.99081 10.2915 10.2708 10.2915 10.5808V15.9308C10.2915 16.3408 9.9615 16.6708 9.5415 16.6708Z"
              fill="white"/>
            <path
              d="M14 16.6703C12.48 16.6703 11.25 15.4403 11.25 13.9203V12.5703C11.25 11.0503 12.48 9.82031 14 9.82031C15.52 9.82031 16.75 11.0503 16.75 12.5703V13.9203C16.75 15.4403 15.52 16.6703 14 16.6703ZM14 11.3303C13.31 11.3303 12.75 11.8903 12.75 12.5803V13.9303C12.75 14.6203 13.31 15.1803 14 15.1803C14.69 15.1803 15.25 14.6203 15.25 13.9303V12.5803C15.25 11.8903 14.69 11.3303 14 11.3303Z"
              fill="white"/>
          </svg>
        `);
                    controlsRow.appendChild(forwardButton);

                    // Progress bar
                    const progressBar = document.createElement("input");
                    progressBar.type = "range";
                    progressBar.classList.add("progress");
                    progressBar.min = 0;
                    progressBar.max = 100;
                    progressBar.value = 0;
                    progressBar.step = 0.1;
                    controlsContainer.appendChild(progressBar);

                    // Time display (00:00 / -00:00)
                    const timeDisplay = document.createElement("div");
                    timeDisplay.classList.add("time-display");
                    const currentTimeDisplay = document.createElement("span");
                    currentTimeDisplay.classList.add("current-time");
                    currentTimeDisplay.textContent = "00:00";
                    const timeLeftDisplay = document.createElement("span");
                    timeLeftDisplay.classList.add("time-left");
                    timeLeftDisplay.textContent = "-00:00";
                    timeDisplay.appendChild(currentTimeDisplay);
                    timeDisplay.appendChild(timeLeftDisplay);
                    controlsContainer.appendChild(timeDisplay);

                    // Set up variables and listeners for this audio
                    let isSeeking = false;

                    audioElement.addEventListener("canplay", () => {
                        // Enable buttons
                        [rewindButton, forwardButton, playButton, pauseButton].forEach((btn) => {
                            btn.classList.add("active");
                        });
                        // Show controls, hide loading
                        controlsContainer.classList.remove("hidden");
                        loadingMessage.classList.add("hidden");
                        updateTimeDisplay();
                        console.log("CAN PLAY");
                    });

                    // Play / Pause
                    playButton.addEventListener("click", () => {
                        if (!audioElement.readyState) return;
                        audioElement.play();
                        playButton.classList.add("hidden");
                        pauseButton.classList.remove("hidden");
                    });
                    pauseButton.addEventListener("click", () => {
                        if (!audioElement.readyState) return;
                        audioElement.pause();
                        playButton.classList.remove("hidden");
                        pauseButton.classList.add("hidden");
                    });

                    // Rewind 10s
                    rewindButton.addEventListener("click", () => {
                        if (audioElement.readyState) {
                            audioElement.currentTime -= 10;
                        }
                    });
                    // Forward 10s
                    forwardButton.addEventListener("click", () => {
                        if (audioElement.readyState) {
                            audioElement.currentTime += 10;
                        }
                    });

                    // Update time display continuously as audio plays
                    audioElement.addEventListener("timeupdate", updateTimeDisplay);
                    // Also update on loadedmetadata
                    audioElement.addEventListener("loadedmetadata", updateTimeDisplay);

                    function updateTimeDisplay() {
                        const currentTime = formatTime(audioElement.currentTime);
                        const timeLeft = formatTime(audioElement.duration - audioElement.currentTime);
                        currentTimeDisplay.textContent = currentTime;
                        timeLeftDisplay.textContent = `-${timeLeft}`;
                    }

                    // Format time as MM:SS
                    function formatTime(time) {
                        if (!time || isNaN(time)) return "00:00";
                        const minutes = Math.floor(time / 60);
                        const seconds = Math.floor(time % 60);
                        return `${String(minutes).padStart(2, "0")}:${String(seconds).padStart(2, "0")}`;
                    }

                    // Smooth progress updates via requestAnimationFrame
                    function updateProgressBar() {
                        if (!isSeeking && audioElement.readyState) {
                            const fraction = audioElement.duration ? audioElement.currentTime / audioElement.duration : 0;
                            const progressPercent = fraction * 100;
                            progressBar.value = progressPercent;
                            progressBar.style.background = `linear-gradient(to right, #E1E1E6 ${progressPercent}%, #3F3D56 ${progressPercent}%)`;
                        }
                        requestAnimationFrame(updateProgressBar);
                    }
                    requestAnimationFrame(updateProgressBar);

                    // Seek when user drags the progress bar
                    progressBar.addEventListener("input", () => {
                        isSeeking = true;
                        const newTime = (progressBar.value / 100) * audioElement.duration;
                        audioElement.currentTime = newTime;
                        progressBar.style.background = `linear-gradient(to right, #E1E1E6 ${progressBar.value}%, #3F3D56 ${progressBar.value}%)`;
                    });
                    progressBar.addEventListener("change", () => {
                        isSeeking = false;
                    });

                    // Save this player's info so we can manage them if needed
                    playerInstances.push({
                        audio: audioElement,
                        wrapper,
                        progressBar,
                    });
                });

                // Helper function to quickly create a button with an SVG
                function createIconButton(svgMarkup) {
                    const btn = document.createElement("button");
                    btn.innerHTML = svgMarkup;
                    return btn;
                }
            });
        </script>
    </body>
</html>
